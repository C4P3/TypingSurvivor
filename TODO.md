# TODOリスト

このドキュメントは、Typing Survivorプロジェクトの未実装の機能や改善点を管理するためのタスクリストです。
タスクは優先度が高いと思われる順に並んでいます。

## 優先度: 高
- [ ] **キャラクターのアニメーションを実装**
  - 向いている方向の画像に切り替える
  - タイピング中に、つるはしを表示してアニメーションを再生する（ループアニメーションを、タイピング継続中だけ再生か？そして、その間ブロックの破壊中アニメーションみたいなのが流せたらなお良い。）
  - 
- [ ] **シングルプレーでの再戦でリミットを解除。また、ルームマッチでのリミットも解除したいかも？**
    - ルームマッチは、合言葉をどこかに保存しとければ、freeマッチとの区別が可能
    - シングルマッチは、ローカルホストなので、リミットはいらない
- [ ] **シングルマッチでハイスコアを記録する**
  - Leaderboardsとの連携、もしくはCloud Save(Clientから呼び出して良い、というかサーバーもローカルホストなので分ける意味がない)で実装。
  - ジングルの勝ち負けにも利用したい。high scoreと比較する。リザルトで、Best Score !!と表示しつつ、上位何％か表示しても良い。
  - ランキング画面を、メインメニューシーンに追加する予定。
- [ ] **マッチング待機画面作成**

## 優先度: 中

- [ ] **`GameUIManager.cs`の責務分割**:
  - 現在`GameUIManager`が担当している低酸素エフェクトのロジックを、専用の`LowOxygenEffectController`クラスに分離することを検討します。
- [ ] **`PlayerFacade.cs`の責務分割**:
  - `ContinuousMove_Server`コルーチン内の移動ロジックを、専用の`PlayerMovement`クラスに分離し、`PlayerFacade`の肥大化を抑制することを検討します。
- [ ] **`CloudSaveService.cs`のリファクタリング**:
  - クライアントサイドとサーバーサイドのロジックが混在しているため、`#region`や`partial`クラスを用いてコードの可読性を向上させることを検討します。
  - `Newtonsoft.Json`への依存について、`JsonUtility`での代替が可能か調査し、不可能であれば依存ライブラリとして明記します。
- [ ] **デバッグ用`OnGUI`コードの管理**:
  - `GameUIManager.cs`と`UIFlowCoordinator.cs`内の`OnGUI`メソッドが、本番ビルドに含まれないように、`UNITY_EDITOR`プリプロセッサで囲むなどの対策を徹底します。
- [ ] **`BombEffect.cs`の改善**:
  - `BombEffect`の爆発半径がハードコードされています。これを`BombEffect`の`ScriptableObject`から設定可能にすることを検討します。

## 優先度: 低

- [ ] **`UIFlowCoordinator.cs`のステートマシン改善**:
  - 巨大な`switch`文で実装されている現在のステートマシンを、よりオブジェクト指向的なStateパターンにリファクタリングすることを検討します。
- [ ] **`LevelManager.cs`の改善**:
  - ハードコードされている`_chunkSize`を`GameConfig`などから設定可能にすることを検討します。
  - `_useRandomSeed`フラグが本番ビルドで有効にならないための警告やチェック機構の導入を検討します。
- [ ] **`WordProvider.cs`の改善**:
  - 単語データベースが空だった場合のフォールバック言語("ja")がハードコードされているため、これを`GameConfig`などで設定可能にすることを検討します。
- [ ] **`InGameHUDManager.cs`の可読性向上**:
  - 多数存在する`if (xxx != null)`のチェックを、null条件演算子(`?.`)に置き換えてコードを簡潔にすることを検討します。
- [ ] **`MusicManager.cs`の`NetworkBehaviour`**:
  - `MusicManager`は`NetworkBehaviour`を継承していますが、シングルトンとしてのみ使用されています。この継承が本当に必要か、あるいはネットワーク機能を持たせるべきか、設計を再検討します。
- [ ] **`ItemService.cs`の汎用化**:
  - `ItemService`が`ILevelService`に依存している現状を、より汎用的な`IWorldService`のようなインターフェースへの依存に切り替えることで、再利用性を高めることを検討します。
- [ ] **`PlayerInput.cs`の改善**:
  - `GameControls`クラスへのハードコードされた参照を、インターフェースと依存性注入を用いるようにリファクタリングすることを検討します。
- [ ] **`PlayerView.cs`の実装**:
  - 現在プレースホルダーとなっている`PlayerView.cs`に、アニメーションやエフェクトなどの実際のビューロジックを実装します。
- [ ] **`TypingChallenge.cs`の最適化**:
  - `GetRemainingRomaji`メソッドの結果をキャッシュすることで、パフォーマンスを向上させることを検討します。
- [ ] **`KanaParser.cs`と`TrieBuilder.cs`の整理**:
  - これらのクラスを`Builder`名前空間に移動し、タイピング機能の内部的な構築プロセスの一部であることを明確にすることを検討します。
## 💡 フェーズ5: 将来的なアイデア
- [ ] **アイテムの連鎖効果の設計**
    - [ ] 爆弾などの一部のアイテムについては、爆発により、他の爆弾を爆発させることができるようにしたい。同時に、この連鎖の影響を受けないアイテムと影響を受けるアイテムを上手く管理したい。
- [ ] **アイテムレーダーや通った通路のミニマップ導入**:
    - [ ] **アイテムレーダー**: 小さい小窓などで四隅の端に、アイテムの存在を示すミニマップ機能を実装し、追加する。
    - [ ] **通った通路のミニマップ**: 近くを通ると、ミニマップの画面に対して少し明るめの色で道があると示すマップの作製

- [ ] **クロススクリーンエフェクトの実装**
    - [ ] アイテム効果をよりダイナミックに表現するため、画面分割の境界を越えて移動するエフェクトを実装する。
    - [ ] **例**: サンダーアイテムを取得したプレイヤーの画面上部から光線が発射され、相手プレイヤーの画面上部からその光線が降ってきて着弾する、といった一連の演出。
    - [ ] **技術的課題**: 各プレイヤーのカメラは異なる`Render Texture`や`Viewport`を持つため、複数のカメラをまたいで描画されるエフェクトには、UIレイヤーや別のカメラを使った特殊な実装が必要になる可能性が高い。

---

## ✅ 完了済みタスク (Completed)
- [x] **リザルト画面作成**
  - モードごとにいろいろ（シングルプレイ、ランクマッチ、レートなしマッチ）
  - 勝った負けたの演出を最初に挟みたい
  - タイプミス、破壊ブロック数、対戦時間（レート変動の数値をランクマッチでは大きく）
  - 再戦とメインメニューのボタンの画面